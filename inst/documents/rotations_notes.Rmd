#rotations_notes.Rmd

Just rough notes.

*4/10/2017*
  
How to make the dataframe that saves results in run_rot flexible to the number of insecticides ?

df_results <- data.frame(generation=1:max_generations,
                         insecticide=NA,
                         r1_active=NA,
                         r1_refuge=NA,
                         r2_active=NA,
                         r2_refuge=NA,
                         r3_active=NA,
                         r3_refuge=NA,
                         r4_active=NA,
                         r4_refuge=NA, stringsAsFactors = FALSE)

Can I adapt this from array_named() in resistance ?
#' n_insecticides <- 3
#' # list(c()) is important below to create one list for each dim
#' l_dimnames <- rep(list(c('no','lo','hi')), n_insecticides)
#' names(l_dimnames) <- paste0("niche", 1:n_insecticides)
#' do.call(array_named,l_dimnames)

# this feels hacky, but it does work & I can put in a function

# create the flexible r* columns
n_insecticides <- 3
l_ <- rep(list(NA), n_insecticides*2) #2 because active & refuge 
names(l_) <- c( paste0("r", 1:n_insecticides, "_active"),
                paste0("r", 1:n_insecticides, "_refuge") )
df_r <- do.call(data.frame,l_)

# create inflexible columns ready to add r* columns on
max_generations <- 10
df_results <- data.frame(generation=1:max_generations,
                         insecticide=NA)

df_results <- data.frame(df_results, df_r)

Note this can only cope with one insceticide being active at a time ? (I could put a comma delimited string in later if I did want to record multiple insecticides).

Does this fit with tidy data ?

Each variable you measure should be in one column.
Each different observation of that variable should be in a different row.

Yes I think it does. Although maybe not ?
Currently I record df_results and gather to df_r2 to allow plotting.
To get :
 generation insecticide    region  resistance
1          1          NA   r1_refuge 0.001000000
2          2           1   r1_refuge 0.001061247

So perhaps I can just save as that to start ? It has multiple rows per generation.
More difficult to see, but easier to plot ?

This allows me to facet by region.
BUT if I wanted to put the lines for active & region into the same subplots (which would make easier to view) I would probably want columns for active and refuge or would I ??

gen active_insecticide resistance_gene active_or_refuge resistance 

I can use tidyr::separate() to get from r1_refuge to r1 & refuge in different columns.

separate(region, into=c("resistance_gene","active_or_refuge"))

I now have run_rot() working for flexible numbers of insecticides (1-5).

done : Next, get active and refuge onto the same plots.  
done : allowed starting frequencies to be set

implemented set_expsoure_rot() now working
dfr <- run_rot(rotation_interval=50, expo_hi=0.9)
dfr <- run_rot(rotation_interval=50, expo_hi=0.2)
# diff frequency curves for r1 & r2
dfr <- run_rot(n=2, rotation_interval=50, expo_hi=c(1,0.1))

started fitness_single_locus() from run_rot()

dfr <- run_rot(n=2, rotation_interval=50, eff=c(1,0.1))

*9/10/17*
~ started first shiny UI : rotresist1
~ add rot interval and generations to rotresist
~ looking good


*10/10/17*

~ seems that resistance evolves more slowly in later insecticides despite same params. Why ?

~ aha! the new UI helped me to see that this can be a result of the decline in resistance frequency for the later insecticides when they are not being used at the start. e.g.

run_rot( n_insecticides = 3 , max_generations = 150 , start_freqs = 0.1 , rotation_interval = 50 , eff = 0.6 , dom = 0.5 , rr = 0.5 , expo_hi = 0.5 , coverage = 0.8 , migration_rate_intervention = 0.01 , cost = 0.1 )

When cost is set to 0 all 3 insecticides give the same curves :

run_rot( n_insecticides = 3 , max_generations = 150 , start_freqs = 0.1 , rotation_interval = 50 , eff = 0.6 , dom = 0.5 , rr = 0.5 , expo_hi = 0.5 , coverage = 0.8 , migration_rate_intervention = 0.01 , cost = 0 )

done ~ in plots change r1 to insecticide_1 etc.
done ~ in plots add the deployment symbol to legend

done ~ can I offer option to have plots on log y axis to make it clearer whats going on at lower frequencies ?

Now from the UI ticking log y axis influences the next plot, (but is isolated so allows you to compare log & non log plots).

Starting to think about sensitivity analysis.
For Levick et al the inputs and ranges were hardcoded into resistance::sensiAnPaperPart()

start_freq |    0.0001 - 0.1 log uniform
exposure |      0.1 - 0.9
male_exposure | 0 - 1
effectiveness | 0.3 - 1
dominance     | 0 - 1
rr_restoration |  0.2 - 1
correct_mix   | 0.5 - 1


To add for rotations 

n_insecticides    | 
max_generations   | 
rotation_interval | 
coverage          | 
migration         |  
cost              | 


# TODO

~ meet with Ian PM to prepare table for sensitivity analysis, we'll need to think about num insecticides, num generations & coverage too

~ what were the ranges for the Levick paper

~ Ian said we may want to 
~ Ian will send me grant app to assess single v multi locus insecticide resistance
~ Ian said we may want to put something in to stop Frequency going below initial starting value when not in use (because this could represent background balance between benefits & cost)



*Ian said first question is to assess whether there is any benefit to rotations when there are no costs and no emigration*

~ test fitness_single_locus() from run_rot() and add to Rmd


~ get Ian to pull changes

# state of play
~ rotations1.Rmd : example plots

                         
                         